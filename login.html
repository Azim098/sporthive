<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sports Hive</title>
    <link rel="stylesheet" href="login.css">
    <style>
        /* Inline CSS for language selector to integrate with your design */
        #language-selector {
            position: relative;
            display: inline-block;
            margin-bottom: 10px;
        }

        .lang-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .lang-btn:hover {
            background-color: #45a049;
        }

        .lang-dropdown {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 4px;
            right: 0;
        }

        #language-selector:hover .lang-dropdown {
            display: block;
        }

        #language-select {
            width: 100%;
            padding: 8px;
            border: none;
            background-color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        #language-select:hover {
            background-color: #ddd;
        }
    </style>
</head>
<body>
    <header style="text-align: right; padding: 10px; background-color: #4B0082; color: white;">
        <div id="language-selector">
            <button class="lang-btn">Language</button>
            <div class="lang-dropdown">
                <select id="language-select" onchange="translatePage()">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                </select>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="login-box">
            <div class="form-container">
                <h2>Login</h2>
                <form id="loginForm">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>

                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>

                    <button type="submit">Login</button>
                </form>
                <p>Don't have an account? <a href="signup.html">Sign up</a></p>
            </div>
        </div>
        <div class="image-box">
            <img src="log.jpg" alt="Fitness Image">
        </div>
    </div>

    <!-- Scripts section -->
    <script type="text/javascript">
        let translateElement;

        function googleTranslateElementInit() {
            translateElement = new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,es,fr,de,it,zh-CN', // Specify supported languages
                autoDisplay: false
            }, 'google_translate_element');
            // Apply saved language if exists
            let savedLang = localStorage.getItem('selectedLanguage') || 'en';
            document.getElementById('language-select').value = savedLang;
            if (savedLang !== 'en') {
                translatePage(savedLang);
            }
        }

        function translatePage(lang) {
            localStorage.setItem('selectedLanguage', lang);
            if (translateElement && window.google && window.google.translate) {
                // Use the widget's internal method to change language (limited support)
                // Note: Direct language switching is not fully supported via script; user interaction may be required
                console.log('Attempting to set language to:', lang);
                // Fallback: Reload page with language parameter if needed
                window.location.search = `?lang=${lang}`;
            }
        }

        // Load Google Translate script once
        window.onload = function() {
            let script = document.createElement('script');
            script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
            document.body.appendChild(script);
        };
    </script>
    <div id="google_translate_element" style="display:none;"></div>

    <!-- Supabase and Login Logic -->
    <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const SUPABASE_URL = "https://idydtkpvhedgyoexkiox.supabase.co";
            const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlkeWR0a3B2aGVkZ3lvZXhraW94Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIwNDI3MzQsImV4cCI6MjA1NzYxODczNH0.52Qb21bBXalYvNPGBoH9xZJUjKs7fjTsESvx2-XCTaY";
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            document.getElementById("loginForm").addEventListener("submit", async (event) => {
                event.preventDefault();

                const email = document.getElementById("email").value.toLowerCase();
                const password = document.getElementById("password").value;

                const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                if (authError) {
                    alert("Login failed: " + authError.message);
                    return;
                }

                if (!authData || !authData.user) {
                    alert("Error: No user data received.");
                    return;
                }

                const userId = authData.user.id;
                console.log("Authenticated User ID:", userId);

                const { data: userData, error: userError } = await supabase
                    .from("users")
                    .select("role")
                    .eq("id", userId)
                    .single();

                console.log("User Data:", userData);

                if (userError || !userData) {
                    alert("Error fetching user data. Please check your database setup.");
                    return;
                }

                if (userData.role === "participant") {
                    window.location.href = "participant.html";
                } else if (userData.role === "organizer") {
                    window.location.href = "organizer.html";
                } else {
                    alert("Invalid user role.");
                }
            });
        });
    </script>
</body>
</html>
